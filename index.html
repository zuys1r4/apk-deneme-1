<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BarisHA TV</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#000000">

  <!-- HLS (m3u8) desteÄŸi -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <style>
    :root{ --bg:#000; --panel:#111; --white:#fff; --muted:#bbb; }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0; background:var(--bg); color:var(--white);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      padding:24px;
    }
    header{ background:#111; padding:16px 20px; border-radius:12px; font-size:20px; }
    .bar{ margin:16px 0; display:flex; gap:10px; flex-wrap:wrap; }
    input[type=text]{
      flex:1; min-width:280px; padding:14px 16px; border-radius:12px; border:1px solid #222;
      background:#0c0c0c; color:#fff; font-size:16px;
    }
    button{
      padding:14px 16px; border-radius:12px; border:1px solid #222; background:#fff; color:#000;
      font-weight:700; cursor:pointer; font-size:16px;
    }
    button:focus, input:focus{ outline:3px solid #fff; outline-offset:2px }
    .stage{ display:grid; place-items:center; margin-top:8px }
    .frame{
      width:96vw; max-width:1280px; aspect-ratio:16/9; background:#000; border-radius:12px; overflow:hidden;
    }
    video, iframe{ width:100%; height:100%; display:block; background:#000 }
    iframe{ border:0 }
    .hint{ color:var(--muted); margin-top:8px; font-size:14px }

    /* TV/10-foot iÃ§in biraz bÃ¼yÃ¼tmeler */
    @media (min-width:1200px) and (min-height:680px){
      body{ font-size:18px }
      header{ font-size:22px }
      button,input{ font-size:18px }
    }
  </style>
</head>
<body>
  <header>ðŸ“º BarisHA TV â€” IPTV + YouTube oynatÄ±cÄ±</header>

  <div class="bar">
    <input id="m3uInput" type="text" placeholder="M3U kanal linki ya da YouTube linki (watch/shorts/live/youtu.be) yapÄ±ÅŸtÄ±r">
    <button id="loadBtn" tabindex="0">YÃ¼kle</button>
  </div>

  <div class="stage">
    <div class="frame">
      <!-- Normal akÄ±ÅŸlar iÃ§in -->
      <video id="player" controls playsinline></video>
      <!-- YouTube iÃ§in -->
      <iframe id="yt" style="display:none"
        allow="autoplay; encrypted-media; picture-in-picture; fullscreen"
        referrerpolicy="origin-when-cross-origin">
      </iframe>
    </div>
    <div class="hint">Ä°pucu: m3u8/MP4 linkleri video ile, YouTube linkleri iframe ile oynatÄ±lÄ±r.</div>
  </div>

<script>
  // === YardÄ±mcÄ±lar ===
  const $ = s => document.querySelector(s);
  const input = $('#m3uInput');
  const btn   = $('#loadBtn');
  const video = $('#player');
  const yt    = $('#yt');
  let hls = null;

  function isHls(u){ return /\.m3u8(\?|$)/i.test(u); }
  function isYouTube(u){ return /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\//i.test(u); }

  // YouTube video ID Ã§Ä±karma (watch?v=, youtu.be/, /live/, /shorts/)
  function youtubeId(url){
    try{
      const u = new URL(url);
      const host = u.hostname.replace(/^www\./,'');
      if (host === 'youtu.be'){
        // https://youtu.be/VIDEOID?t=123
        return u.pathname.split('/')[1];
      }
      if (host === 'youtube.com' || host === 'm.youtube.com' || host === 'youtube-nocookie.com'){
        // /watch?v=, /live/VIDEOID, /shorts/VIDEOID
        if (u.searchParams.get('v')) return u.searchParams.get('v');
        const parts = u.pathname.split('/').filter(Boolean);
        // /live/ID veya /shorts/ID
        if (parts[0] === 'live'   && parts[1]) return parts[1];
        if (parts[0] === 'shorts' && parts[1]) return parts[1];
      }
    }catch(e){}
    return null;
  }

  function destroyHls(){ if(hls){ try{ hls.destroy(); }catch{} hls = null; } }

  // Normal (HLS/MP4) oynatma
  function playVideo(url){
    // video aktif, yt gizli
    yt.style.display = 'none';
    yt.src = 'about:blank';

    destroyHls();
    video.pause();
    if (window.Hls && Hls.isSupported() && isHls(url)){
      hls = new Hls({lowLatencyMode:true});
      hls.loadSource(url);
      hls.attachMedia(video);
    }else{
      video.src = url;
    }
    video.style.display = 'block';
    video.play().catch(()=>{});
  }

  // YouTube gÃ¶mme
  function playYouTube(url){
    const id = youtubeId(url);
    if(!id){ alert('YouTube baÄŸlantÄ±sÄ± Ã§Ã¶zÃ¼mlenemedi. LÃ¼tfen tam video baÄŸlantÄ±sÄ± kullanÄ±n.'); return; }

    // video gizli, yt aktif
    destroyHls();
    video.pause();
    video.style.display = 'none';

    // TV/PIP/Autoplay dostu embed URL
    const embed = `https://www.youtube.com/embed/${id}?autoplay=1&playsinline=1&modestbranding=1&rel=0`;
    yt.src = embed;
    yt.style.display = 'block';
  }

  function playUrl(url){
    if(!url){ alert('LÃ¼tfen bir link girin.'); return; }
    if (isYouTube(url)) playYouTube(url);
    else playVideo(url);
  }

  // UI olaylarÄ±
  btn.addEventListener('click', ()=> playUrl(input.value.trim()));
  input.addEventListener('keydown', e=>{ if(e.key==='Enter') btn.click(); });

  // TV kumandasÄ±: basit DPAD odak
  const focusables = [input, btn];
  let fIndex = 0; focusables[fIndex].focus();
  document.addEventListener('keydown', (e)=>{
    if (['ArrowRight','ArrowDown'].includes(e.key)){
      fIndex = (fIndex + 1) % focusables.length; focusables[fIndex].focus(); e.preventDefault();
    }else if (['ArrowLeft','ArrowUp'].includes(e.key)){
      fIndex = (fIndex - 1 + focusables.length) % focusables.length; focusables[fIndex].focus(); e.preventDefault();
    }else if (e.key === 'Enter'){ document.activeElement?.click(); }
    else if (e.key === 'Backspace' || e.key === 'Escape'){
      try{ if(document.fullscreenElement) document.exitFullscreen(); }catch{}
    }else if (e.key === 'MediaPlayPause'){
      try{ video.paused ? video.play() : video.pause(); }catch{}
    }
  });

  // EkranÄ± aÃ§Ä±k tut (olanak varsa)
  let _wl;
  async function keepScreenOn(){
    try{ _wl = await navigator.wakeLock.request('screen'); }catch{}
  }
  window.addEventListener('load', keepScreenOn);
  document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) keepScreenOn(); });

  // Service worker kaydÄ± (PWA)
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js").catch(()=>{});
    });
  }
</script>
</body>
</html>
